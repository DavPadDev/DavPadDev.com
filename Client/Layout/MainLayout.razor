@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Routing
@using DavPadDev.Services
@inject NavigationManager Nav
@inject ModalService ModalService
@implements IDisposable

<div class="layout-wrapper">
    <!-- Modal (always present, controlled by service) -->
    <Modal />

    <!-- Hero banner -->
    <section class="layout-hero-image">
        <img src="images/default-monochrome-black.svg" alt="Site banner" />
    </section>

    <!-- Top Header / Navbar -->
    <header class="site-header">
        <div class="site-header-inner">
            <div class="brand">
                DavPadDev
            </div>

            <!-- Mobile hamburger -->
            <button class="nav-toggle"
                    @onclick="ToggleNav"
                    aria-expanded="@_navOpen"
                    aria-label="Toggle navigation">
                ☰
            </button>

            <!-- Nav links -->
            <nav class="nav-links @( _navOpen ? "open" : string.Empty )">
                <NavLink href="" Match="NavLinkMatch.All">Home</NavLink>
                <NavLink href="about">About</NavLink>
                <NavLink href="projects">Projects</NavLink>
                <NavLink href="resume">Resume</NavLink>
                <NavLink href="contact">Contact</NavLink>
            </nav>
        </div>
    </header>

    <!-- Page content -->
    <main class="main-layout">
        @Body
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <p>
            @DateTime.Now.Year DavPadDev ·
            Built with <strong>Blazor WebAssembly</strong> 🚀
        </p>
    </footer>
</div>

@code
{
    private bool _navOpen;

    private void ToggleNav() => _navOpen = !_navOpen;

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        if (_navOpen)
        {
            _navOpen = false;
            InvokeAsync(StateHasChanged);
        }
    }

    protected override void OnInitialized()
    {
        Nav.LocationChanged += OnLocationChanged;
    }

    public void Dispose()
    {
        Nav.LocationChanged -= OnLocationChanged;
    }
}
